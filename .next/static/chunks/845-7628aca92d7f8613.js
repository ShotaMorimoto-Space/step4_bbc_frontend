(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[845],{357:function(t,e,o){"use strict";var r,a;t.exports=(null==(r=o.g.process)?void 0:r.env)&&"object"==typeof(null==(a=o.g.process)?void 0:a.env)?o.g.process:o(8081)},8081:function(t){!function(){var e={229:function(t){var e,o,r,a=t.exports={};function n(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function i(t){if(e===setTimeout)return setTimeout(t,0);if((e===n||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(o){try{return e.call(null,t,0)}catch(o){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:n}catch(t){e=n}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(t){o=s}}();var c=[],u=!1,l=-1;function E(){u&&r&&(u=!1,r.length?c=r.concat(c):l=-1,c.length&&T())}function T(){if(!u){var t=i(E);u=!0;for(var e=c.length;e;){for(r=c,c=[];++l<e;)r&&r[l].run();l=-1,e=c.length}r=null,u=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(t)}}function h(t,e){this.fun=t,this.array=e}function d(){}a.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var o=1;o<arguments.length;o++)e[o-1]=arguments[o];c.push(new h(t,e)),1!==c.length||u||i(T)},h.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=d,a.addListener=d,a.once=d,a.off=d,a.removeListener=d,a.removeAllListeners=d,a.emit=d,a.prependListener=d,a.prependOnceListener=d,a.listeners=function(t){return[]},a.binding=function(t){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},o={};function r(t){var a=o[t];if(void 0!==a)return a.exports;var n=o[t]={exports:{}},s=!0;try{e[t](n,n.exports,r),s=!1}finally{s&&delete o[t]}return n.exports}r.ab="//";var a=r(229);t.exports=a}()},8357:function(t,e,o){"use strict";o.d(e,{$w:function(){return n},CT:function(){return a},Hz:function(){return r},Pn:function(){return s},WU:function(){return i},wF:function(){return c}});let r={BASE_URL:"https://aps-bbc-02-dhdqd5eqgxa7f0hg.canadacentral-01.azurewebsites.net",API_VERSION:o(357).env.NEXT_PUBLIC_API_VERSION||"v1",TIMEOUT:3e4,MAX_RETRIES:3,RETRY_DELAY:1e3},a="".concat(r.BASE_URL,"/api/").concat(r.API_VERSION),n=r.BASE_URL,s={AUTH:{LOGIN:"/auth/token",REGISTER_USER:"/auth/register/user",REGISTER_COACH:"/auth/register/coach",ME:"/auth/me"},USER:{PROFILE:"/user/profile",MY_VIDEOS:"/my-videos",MY_RESERVATIONS:"/my-reservations",CREATE_RESERVATION:"/create-reservation"},COACH:{PROFILE:"/coach/profile",SAVE_ADVICES:"/coach/save-advices",GET_ADVICES:"/coach/get-advices",CREATE_SECTION_GROUP:"/coach/create-section-group",ADD_SECTION:"/coach/add-section",ADD_COACH_COMMENT:"/coach/add-coach-comment",UPDATE_SECTION:"/coach/update-section",GET_SECTION:"/coach/section",GET_SECTIONS:"/coach/sections",DELETE_SECTION:"/coach/section",ANALYZE_SECTION:"/coach/analyze-section",ADD_OVERALL_FEEDBACK:"/coach/add-overall-feedback",GET_OVERALL_FEEDBACK:"/coach/overall-feedback"},VIDEO:{GET_VIDEO:"/video",GET_VIDEO_WITH_SECTIONS:"/video/with-sections",GET_FEEDBACK_SUMMARY:"/video/feedback-summary",GET_ALL_VIDEOS:"/videos",SEARCH_VIDEOS:"/videos/search",CREATE_SESSION:"/video/session",GET_SESSIONS:"/video/sessions",GET_SESSION:"/session",UPDATE_SESSION:"/session",DELETE_SESSION:"/session"},UPLOAD:{UPLOAD_VIDEO:"/upload/upload-video",UPLOAD_THUMBNAIL:"/upload/upload-thumbnail",UPLOAD_STATUS:"/upload/upload-status",DELETE_VIDEO:"/upload/video",CLEAR_ALL_DATA:"/upload/clear-all-data",PROXY_FILE:"/upload/proxy-file",MEDIA_URL:"/upload/media-url",MEDIA_URL_SIMPLE:"/upload/media-url-simple",CAPTURE_VIDEO_FRAME:"/upload/capture-video-frame",UPLOAD_MARKUP_IMAGE:"/upload/upload-markup-image"},TRANSCRIPTION:{TRANSCRIBE_AUDIO:"/transcription/transcribe-audio"},LINE:{WEBHOOK:"/line/webhook",LOGIN:"/line/login",DEV_ECHO:"/line/dev/echo"},LOCATION:{LIST:"/locations",GET:"/locations",CREATE:"/locations",UPDATE:"/locations"},MEDIA_URL:"/media-url",PROXY_FILE:"/proxy-file",UPLOAD_SECTION_IMAGE:"/upload-section-image",UPLOAD_MARKUP_IMAGE_MAIN:"/upload-markup-image"},i={GET:"GET",POST:"POST",PUT:"PUT",PATCH:"PATCH",DELETE:"DELETE"},c={JSON:"application/json",FORM_DATA:"multipart/form-data",TEXT:"text/plain"}},6845:function(t,e,o){"use strict";o.d(e,{e8:function(){return E}});var r=o(8357);class a extends Error{constructor(t,e,o,r){super(r||"API Error: ".concat(t," ").concat(e)),this.status=t,this.statusText=e,this.responseData=o,this.name="ApiError"}}class n{static getToken(){return localStorage.getItem(this.TOKEN_KEY)}static setToken(t){localStorage.setItem(this.TOKEN_KEY,t)}static getRefreshToken(){return localStorage.getItem(this.REFRESH_TOKEN_KEY)}static setRefreshToken(t){localStorage.setItem(this.REFRESH_TOKEN_KEY,t)}static clearTokens(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.REFRESH_TOKEN_KEY)}static isTokenExpired(t){try{let e=JSON.parse(atob(t.split(".")[1])),o=1e3*e.exp;return Date.now()>=o}catch(t){return!0}}}async function s(t,e){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.Hz.MAX_RETRIES;try{let o=await fetch(t,e);if(o.ok||o.status>=500||o.status>=400&&o.status<500)return o;throw Error("HTTP ".concat(o.status,": ").concat(o.statusText))}catch(a){if(o>0)return await new Promise(t=>setTimeout(t,r.Hz.RETRY_DELAY)),s(t,e,o-1);throw a}}async function i(t,e){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.Hz.TIMEOUT,n=new AbortController,i=setTimeout(()=>n.abort(),o);try{let o=await s(t,{...e,signal:n.signal});return clearTimeout(i),o}catch(t){if(clearTimeout(i),t instanceof Error&&"AbortError"===t.name)throw new a(408,"Request Timeout",null,"リクエストがタイムアウトしました");throw t}}async function c(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{method:o=r.WU.GET,headers:s={},body:c,timeout:u=r.Hz.TIMEOUT}=e,l=t.startsWith("http")?t:"".concat(r.CT).concat(t),E={"Content-Type":r.wF.JSON,...s},T=n.getToken();T&&!n.isTokenExpired(T)&&(E.Authorization="Bearer ".concat(T));let h={method:o,headers:E,credentials:"include"};c&&(c instanceof FormData?(delete E["Content-Type"],h.body=c):"string"==typeof c?h.body=c:h.body=JSON.stringify(c));try{let t;let e=await i(l,h,u),o=e.headers.get("content-type");if(t=o&&o.includes("application/json")?await e.json():o&&o.includes("text/")?await e.text():await e.blob(),!e.ok)throw new a(e.status,e.statusText,t,"API request failed: ".concat(e.status," ").concat(e.statusText));return{data:t,status:e.status,statusText:e.statusText,headers:Object.fromEntries(e.headers.entries())}}catch(t){if(t instanceof a)throw t;throw new a(0,"Network Error",null,t instanceof Error?t.message:"ネットワークエラーが発生しました")}}n.TOKEN_KEY="sb:auth_token",n.REFRESH_TOKEN_KEY="sb:refresh_token";let u={get:(t,e)=>c(t,{...e,method:r.WU.GET}),post:(t,e,o)=>c(t,{...o,method:r.WU.POST,body:e})},l={isAuthenticated:()=>{let t=n.getToken();return null!==t&&!n.isTokenExpired(t)},getToken:()=>n.getToken(),setToken:t=>n.setToken(t),logout:()=>{n.clearTokens(),localStorage.removeItem("sb:auth"),localStorage.removeItem("sb:roleCandidate")}};class E{static async login(t){try{console.log("ログイン送信データ:",JSON.stringify({username:t.username,endpoint:r.Pn.AUTH.LOGIN,fullUrl:"".concat(r.CT).concat(r.Pn.AUTH.LOGIN)},null,2));let e=new FormData;e.append("username",t.username),e.append("password",t.password),console.log("FormData送信:",JSON.stringify({username:t.username,password:"***",formDataEntries:Array.from(e.entries())},null,2)),console.log("=== プロキシ経由でログインを試行開始 ==="),console.log("プロキシURL:","/api/auth/login"),console.log("リクエストメソッド:","POST"),console.log("FormData内容:",Array.from(e.entries()));let o=await fetch("/api/auth/login",{method:"POST",body:e});if(console.log("プロキシレスポンス受信:",{status:o.status,statusText:o.statusText,ok:o.ok,headers:Object.fromEntries(o.headers.entries())}),!o.ok){let t=await o.text();console.error("プロキシレスポンスエラー:",{status:o.status,statusText:o.statusText,body:t});try{let e=JSON.parse(t);if(console.log("プロキシエラーデータ詳細:",e),e.details)throw Error("Backend Error: ".concat(e.error,"\nDetails: ").concat(e.details,"\nRaw: ").concat(e.rawResponse||"N/A"))}catch(t){console.log("エラーデータの解析に失敗:",t)}throw Error("HTTP ".concat(o.status,": ").concat(o.statusText))}let a=await o.json();return console.log("プロキシレスポンス成功:",a),a.access_token&&l.setToken(a.access_token),a}catch(t){throw console.error("Login failed:",t),t}}static async registerUser(t){try{return(await u.post(r.Pn.AUTH.REGISTER_USER,t)).data}catch(t){throw console.error("User registration failed:",t),t}}static async registerCoach(t){try{return(await u.post(r.Pn.AUTH.REGISTER_COACH,t)).data}catch(t){throw console.error("Coach registration failed:",t),t}}static async getMe(){try{return(await u.get(r.Pn.AUTH.ME)).data}catch(t){throw console.error("Failed to get user info:",t),t}}static async logout(){try{l.logout()}catch(t){console.error("Logout failed:",t),l.logout()}}static isAuthenticated(){return l.isAuthenticated()}static getToken(){return l.getToken()}static isTokenValid(){let t=this.getToken();if(!t)return!1;try{let e=JSON.parse(atob(t.split(".")[1])),o=1e3*e.exp;return Date.now()<o}catch(t){return!1}}static async getUserRole(){try{if(!this.isAuthenticated())return null;return(await this.getMe()).role}catch(t){return console.error("Failed to get user role:",t),null}}}}}]);