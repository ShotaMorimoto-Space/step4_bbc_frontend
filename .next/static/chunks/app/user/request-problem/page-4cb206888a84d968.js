(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[832],{8026:function(e,t,o){Promise.resolve().then(o.bind(o,1563))},1563:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return i}});var l=o(7437),r=o(2265),s=o(6463),a=o(9936),n=o(869);let c=["スライス","フック","トップ","ダフリ","飛距離不足","方向性","弾道の高さ","スピン量","リズム","ミート率"];function i(){let e=(0,s.useRouter)(),[t,o]=(0,r.useState)([]),[i,u]=(0,r.useState)(""),[h,d]=(0,r.useState)({});(0,r.useEffect)(()=>{let e=localStorage.getItem("sb:req:draft");if(e)try{let t=JSON.parse(e);d(t),console.log("取得したドラフトデータ:",t)}catch(e){console.error("ドラフトデータの解析に失敗:",e)}},[]);let b=e=>{t.includes(e)?o(t.filter(t=>t!==e)):t.length<2&&o([...t,e])},g=async()=>{console.log("次へ進む - 選択された問題:",t),console.log("次へ進む - 入力されたメモ:",i);let o=JSON.parse(localStorage.getItem("sb:req:draft")||"{}"),l={...o,problems:t,note:i};console.log("保存前のドラフト:",o),console.log("更新後のドラフト:",l),localStorage.setItem("sb:req:draft",JSON.stringify(l)),console.log("localStorageに保存されたドラフト:",localStorage.getItem("sb:req:draft"));let r=localStorage.getItem("sb:req:files");if(r)try{let o=JSON.parse(r);if(o.length>0&&o[0]&&o[0].url){if(console.log("保存されたファイル:",o),!o[0].name||!o[0].url){console.error("ファイル情報が不完全:",o[0]),alert("ファイル情報が不完全です。確認画面で再度アップロードしてください。"),e.push("/user/request-confirm");return}try{let r;let s=new FormData;try{if(!o[0].url||"undefined"===o[0].url||"null"===o[0].url)throw Error("動画ファイルのURLが無効です");if(!(r=o[0].url.startsWith("blob:")?o[0].blob||await fetch(o[0].url).then(e=>e.blob()):await fetch(o[0].url).then(e=>e.blob())))throw Error("動画ファイルの取得に失敗しました");s.append("video_file",r,o[0].name),console.log("動画ファイルを追加:",o[0].name)}catch(t){console.error("動画ファイルの取得エラー:",t),alert("動画ファイルの処理に失敗しました。確認画面で再度アップロードしてください。"),e.push("/user/request-confirm");return}let a=localStorage.getItem("user_id"),n=localStorage.getItem("user_email");if(a&&s.append("user_id",a),n&&s.append("user_email",n),l.club&&(s.append("club_type",l.club),console.log("クラブタイプを追加:",l.club)),t.length>0){let e=t.join(", ");s.append("swing_form",e),console.log("スイング形式（問題）を追加:",e)}if(i&&(s.append("swing_note",i),console.log("スイングメモを追加:",i)),l.videoThumb&&l.videoThumb.startsWith("data:image/"))try{let e=await fetch(l.videoThumb),t=await e.blob();s.append("thumbnail_file",t,"thumbnail.jpg"),console.log("サムネイルファイルを追加")}catch(e){console.error("サムネイル処理エラー:",e),console.log("サムネイルなしでアップロードを続行します")}for(let[e,t]of(console.log("FormDataの内容確認:"),s.entries()))console.log("".concat(e,":"),t);let c="https://aps-bbc-02-dhdqd5eqgxa7f0hg.canadacentral-01.azurewebsites.net/api/v1",u="".concat(c,"/upload-video");for(let[e,t]of(console.log("アップロードURL:",u),console.log("APIベースURL:",c),console.log("完全なURL:",u),console.log("FormDataの内容（送信前）:"),s.entries()))console.log("".concat(e,":"),t);let h=await fetch(u,{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("access_token"))},body:s}).catch(e=>{throw console.error("fetch実行エラー:",e),Error("ネットワークエラー: ".concat(e.message))});if(h.ok){let t=await h.json();console.log("動画アップロード成功:",t),e.push("/user/request-confirm")}else{console.error("動画アップロード失敗:",h.status,h.statusText);try{let e=await h.text();console.error("エラー詳細:",e),alert("動画アップロードに失敗しました: ".concat(h.status," ").concat(h.statusText,"\n\n詳細: ").concat(e))}catch(e){alert("動画アップロードに失敗しました: ".concat(h.status," ").concat(h.statusText))}}}catch(t){console.error("動画アップロードエラー:",t);let e=t instanceof Error?t.message:String(t);alert("動画アップロード中にエラーが発生しました:\n\n".concat(e))}}else e.push("/user/request-confirm")}catch(t){console.error("ファイル解析エラー:",t),e.push("/user/request-confirm")}else e.push("/user/request-confirm")};return(0,l.jsxs)(a.T,{title:"問題選択",subtitle:"スイングの問題を選択してください（最大2つまで）",showBackButton:!0,onBackClick:()=>{e.push("/user/request-club")},currentStep:2,totalSteps:4,children:[h.club&&(0,l.jsxs)("div",{className:"bg-blue-500/20 border border-blue-500/30 rounded-lg p-4 text-blue-300 text-sm mb-6",children:[(0,l.jsx)("div",{className:"font-bold mb-2",children:"選択されたクラブ:"}),(0,l.jsx)("div",{children:h.club})]}),(0,l.jsx)("div",{className:"mb-8",children:(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:c.map(e=>{let o=t.includes(e);return(0,l.jsx)("button",{onClick:()=>b(e),disabled:!o&&t.length>=2,className:"px-4 py-2 rounded-full text-sm transition-all duration-200 ".concat(o?"bg-white text-violet-600 border border-white shadow-lg":t.length>=2&&!o?"bg-white/10 text-white/50 border border-white/10 cursor-not-allowed":"bg-white/20 text-white border border-white/30 hover:bg-white/30 hover:scale-105"),children:e},e)})})}),(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("h2",{className:"text-white mb-2 text-lg font-medium",children:"自由記入（任意）"}),(0,l.jsx)("textarea",{value:i,onChange:e=>u(e.target.value),placeholder:"その他あれば記入してください",className:"w-full min-h-[120px] bg-white/20 rounded-2xl text-white p-4 placeholder-white/60 border border-white/30 focus:outline-none focus:border-white/50 transition-colors resize-none"})]}),(0,l.jsx)("div",{className:"mt-8",children:(0,l.jsx)(n.Jr,{onClick:g,className:"w-full",children:"次へ"})})]})}}},function(e){e.O(0,[137,971,23,744],function(){return e(e.s=8026)}),_N_E=e.O()}]);