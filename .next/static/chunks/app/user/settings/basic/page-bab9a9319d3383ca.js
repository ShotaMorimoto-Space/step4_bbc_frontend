(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[186],{8e3:function(e,t,r){Promise.resolve().then(r.bind(r,2059))},2059:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var s=r(7437),a=r(2265),l=r(6463),i=r(4697),n=r(2022),o=r(233),c=r(9061),d=r(2637),u=r(869),x=r(1887);function h(){let e=(0,l.useRouter)(),[t,r]=(0,a.useState)({name:"",birthDate:"",gender:"",avatar:""}),[h,m]=(0,a.useState)(!1),[g,p]=(0,a.useState)(""),[f,b]=(0,a.useState)("");(0,a.useEffect)(()=>{(()=>{let t=(0,x.le)("access_token"),s=(0,x.le)("user_email"),a=(0,x.le)("user_id");if(console.log("認証チェック:",{token:t?"あり":"なし",email:s||"なし",userId:a||"なし"}),!t||!s||!a){console.log("認証情報不足のためログインページに遷移"),e.push("/auth/login");return}r({name:(0,x.le)("user_name")||"",birthDate:(0,x.le)("user_birth_date")||"",gender:(0,x.le)("user_gender")||"",avatar:(0,x.le)("user_avatar")||""})})()},[e]);let v=e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!s)return;if(s.size>5242880){b("ファイルサイズは5MB以下にしてください"),setTimeout(()=>b(""),5e3);return}if(!s.type.startsWith("image/")){b("画像ファイルを選択してください"),setTimeout(()=>b(""),5e3);return}let a=new FileReader;a.onload=e=>{var t;let s=null===(t=e.target)||void 0===t?void 0:t.result;r(e=>({...e,avatar:s}))},a.readAsDataURL(s),e.target.value=""},j=async()=>{m(!0),b("");try{let r=(0,x.le)("access_token"),s=(0,x.le)("user_id");if(console.log("認証情報確認:",{accessToken:r?"あり":"なし",userId:s||"なし"}),!r)throw Error("アクセストークンが不足しています");let a=s;if(!a&&(0,x.le)("user_email"))try{let e=await fetch("/api/auth/me",{headers:{Authorization:"Bearer ".concat(r)}});if(e.ok){let t=await e.json();console.log("/api/auth/meレスポンス詳細:",t);let r=null;t.profile&&t.profile.user_id?r=t.profile.user_id:t.user_id?r=t.user_id:t.id&&(r=t.id),r?(a=r,console.log("APIから取得したユーザーID:",r)):console.warn("/api/auth/meレスポンスにuser_idが含まれていません:",t)}else console.error("ユーザーID取得失敗:",e.status,e.statusText)}catch(e){console.error("ユーザーID取得エラー:",e)}if(!a)throw Error("ユーザーIDが取得できません");let l={username:t.name,gender:t.gender,birthday:t.birthDate,profile_picture_url:t.avatar};console.log("送信データ:",{...l,user_id:a});let i=await fetch("/api/auth/user/profile",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({...l,user_id:a})});if(console.log("APIレスポンス:",{status:i.status,statusText:i.statusText,ok:i.ok}),!i.ok){console.error("APIレスポンスエラー:",{status:i.status,statusText:i.statusText,url:i.url});let e="基本情報の更新に失敗しました";try{let t=await i.json();console.error("エラーレスポンス詳細:",t),e=t.detail||t.message||e}catch(t){console.error("エラーレスポンスのパースに失敗:",t);let e=await i.text();console.error("エラーレスポンス（テキスト）:",e)}throw Error(e)}(0,x.D$)("user_name",t.name),(0,x.D$)("user_gender",t.gender),(0,x.D$)("user_birth_date",t.birthDate),(0,x.D$)("user_avatar",t.avatar),p("基本情報が更新されました"),setTimeout(()=>{e.push("/user/settings")},1500)}catch(e){console.error("基本情報更新エラー:",e),b(e.message||"基本情報の更新に失敗しました"),setTimeout(()=>b(""),5e3)}finally{m(!1)}};return(0,s.jsxs)(d.d,{title:"基本情報編集",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-4 pt-4 pb-2",children:[(0,s.jsx)("button",{onClick:()=>e.push("/user/settings"),className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center",children:(0,s.jsx)(i.Z,{size:20,className:"text-white"})}),(0,s.jsx)("h1",{className:"text-white text-lg font-medium",children:"基本情報編集"}),(0,s.jsx)("div",{className:"w-10"})," "]}),(0,s.jsxs)("main",{className:"flex-1 overflow-y-auto px-4 pb-4",children:[g&&(0,s.jsx)(u.Ou,{message:g}),f&&(0,s.jsx)(u.Ou,{message:f}),(0,s.jsxs)("div",{className:"mb-6 p-4 bg-blue-500/20 border border-blue-500/30 rounded-lg text-blue-300 text-xs",children:[(0,s.jsx)("div",{children:"デバッグ情報:"}),(0,s.jsxs)("div",{children:["アクセストークン: ",(0,x.le)("access_token")?"あり":"なし"]}),(0,s.jsxs)("div",{children:["ユーザーID: ",(0,x.le)("user_id")||"なし"]}),(0,s.jsxs)("div",{children:["メール: ",(0,x.le)("user_email")||"なし"]})]}),(0,s.jsxs)("div",{className:"bg-white/10 rounded-2xl p-6",children:[(0,s.jsx)("h3",{className:"text-white text-lg font-medium mb-6",children:"基本情報"}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{onClick:()=>{var e;return null===(e=document.getElementById("avatar-input"))||void 0===e?void 0:e.click()},className:"w-20 h-20 rounded-full bg-white/20 flex items-center justify-center overflow-hidden cursor-pointer hover:bg-white/30 transition-colors relative group",children:[t.avatar?(0,s.jsx)("img",{src:t.avatar,alt:"Avatar",className:"w-full h-full object-cover"}):(0,s.jsx)(n.Z,{size:32,className:"text-white/70"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:(0,s.jsx)(o.Z,{size:24,className:"text-white"})})]}),(0,s.jsx)("input",{id:"avatar-input",type:"file",accept:"image/*",onChange:e=>v(e),className:"hidden"}),(0,s.jsxs)("div",{className:"text-white/70 text-sm",children:["画像をタップして",(0,s.jsx)("br",{}),"変更できます"]})]}),(0,s.jsx)("div",{children:(0,s.jsx)(u.ic,{label:"名前",type:"text",value:t.name,onChange:e=>r(t=>({...t,name:e.target.value})),placeholder:"名前を入力"})}),(0,s.jsx)("div",{children:(0,s.jsx)(u.ic,{label:"生年月日",type:"date",value:t.birthDate,onChange:e=>r(t=>({...t,birthDate:e.target.value}))})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-white/70 text-sm mb-2",children:"性別"}),(0,s.jsxs)("select",{value:t.gender,onChange:e=>r(t=>({...t,gender:e.target.value})),className:"w-full px-3 py-2 bg-white/20 text-white rounded-lg border border-white/20 focus:outline-none focus:border-white/40",children:[(0,s.jsx)("option",{value:"",children:"選択してください"}),(0,s.jsx)("option",{value:"male",children:"男性"}),(0,s.jsx)("option",{value:"female",children:"女性"}),(0,s.jsx)("option",{value:"other",children:"その他"})]})]})]}),(0,s.jsxs)("div",{className:"flex gap-3 mt-8",children:[(0,s.jsxs)(u.Jr,{onClick:j,disabled:h,className:"flex-1 flex items-center justify-center gap-2",children:[(0,s.jsx)(c.Z,{size:16}),h?"保存中...":"保存"]}),(0,s.jsxs)(u.Jr,{variant:"secondary",onClick:()=>e.push("/user/settings"),className:"flex-1 flex items-center justify-center gap-2",children:[(0,s.jsx)(i.Z,{size:16}),"キャンセル"]})]})]})]})]})}},1066:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var s=r(2265),a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),i=(e,t)=>{let r=(0,s.forwardRef)((r,i)=>{let{color:n="currentColor",size:o=24,strokeWidth:c=2,absoluteStrokeWidth:d,className:u="",children:x,...h}=r;return(0,s.createElement)("svg",{ref:i,...a,width:o,height:o,stroke:n,strokeWidth:d?24*Number(c)/Number(o):c,className:["lucide","lucide-".concat(l(e)),u].join(" "),...h},[...t.map(e=>{let[t,r]=e;return(0,s.createElement)(t,r)}),...Array.isArray(x)?x:[x]])});return r.displayName="".concat(e),r}},5137:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(1066).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},233:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(1066).Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},9061:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(1066).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},4258:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(1066).Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},2022:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(1066).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},4697:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(1066).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},6463:function(e,t,r){"use strict";var s=r(1169);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})},869:function(e,t,r){"use strict";r.d(t,{Jr:function(){return l},Ou:function(){return n},ic:function(){return i},j7:function(){return a}});var s=r(7437);r(2265);let a=e=>{let{title:t,subtitle:r,children:a,showBackButton:l=!1,onBackClick:i,backButtonText:n="戻る"}=e;return(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-violet-400 via-violet-600 to-violet-800 flex flex-col items-center justify-center p-6 relative overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute inset-0 opacity-5 pointer-events-none",children:(0,s.jsx)("div",{className:"absolute inset-0",style:{backgroundImage:"\n            linear-gradient(45deg, rgba(255,255,255,0.1) 25%, transparent 25%),\n            linear-gradient(-45deg, rgba(255,255,255,0.1) 25%, transparent 25%),\n            linear-gradient(45deg, transparent 75%, rgba(255,255,255,0.1) 75%),\n            linear-gradient(-45deg, transparent 75%, rgba(255,255,255,0.1) 75%)\n          ",backgroundSize:"40px 40px",backgroundPosition:"0 0, 0 20px, 20px -20px, -20px 0px"}})}),(0,s.jsxs)("div",{className:"absolute inset-0 opacity-5 pointer-events-none",children:[(0,s.jsx)("div",{className:"absolute top-20 left-10 w-32 h-32 bg-white rounded-full blur-3xl"}),(0,s.jsx)("div",{className:"absolute bottom-40 right-10 w-40 h-40 bg-white rounded-full blur-3xl"}),(0,s.jsx)("div",{className:"absolute top-1/2 left-1/4 w-24 h-24 bg-white rounded-full blur-2xl"})]}),(0,s.jsx)("div",{className:"relative z-10 flex-1 flex flex-col items-center justify-center text-center mb-16",children:(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-6xl md:text-7xl font-light text-white mb-1",style:{fontFamily:"Brush Script MT, cursive",textShadow:"0 4px 8px rgba(0,0,0,0.3)"},children:t}),r&&(0,s.jsx)("p",{className:"text-lg sm:text-xl text-white/90 mb-6",children:r})]})}),(0,s.jsx)("div",{className:"relative z-10 w-full max-w-sm mb-8",children:a}),l&&i&&(0,s.jsx)("div",{className:"absolute top-6 left-6 z-20",children:(0,s.jsx)("button",{onClick:i,className:"p-2 text-white hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",title:n,children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("path",{d:"M19 12H5M12 19l-7-7 7-7"})})})})]})},l=e=>{let{children:t,onClick:r,disabled:a=!1,variant:l="primary",className:i=""}=e;return(0,s.jsx)("button",{onClick:r,disabled:a,className:"".concat("w-full font-semibold py-4 px-6 rounded-full transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"," ").concat({primary:"bg-white bg-opacity-95 hover:bg-opacity-100 text-gray-800",secondary:"bg-violet-500 hover:bg-violet-600 text-white",danger:"bg-red-500 hover:bg-red-600 text-white"}[l]," ").concat(i),children:t})},i=e=>{let{label:t,type:r,value:a,onChange:l,placeholder:i,disabled:n=!1,maxLength:o,max:c,error:d,required:u=!1,className:x=""}=e;return(0,s.jsxs)("div",{className:x,children:[(0,s.jsxs)("label",{className:"block text-white text-sm font-medium mb-2",children:[t,u&&(0,s.jsx)("span",{className:"text-red-400 ml-1",children:"*"})]}),(0,s.jsx)("input",{type:r,value:a,onChange:l,className:"w-full bg-white bg-opacity-20 border rounded-xl px-4 py-3 text-white placeholder-white placeholder-opacity-70 focus:outline-none focus:border-white focus:border-opacity-60 ".concat(d?"border-red-400":"border-white border-opacity-30"),placeholder:i,disabled:n,maxLength:o,max:c}),d&&(0,s.jsx)("p",{className:"text-red-400 text-sm mt-1",children:d})]})},n=e=>{let{message:t,className:r=""}=e;return(0,s.jsx)("div",{className:"bg-red-500 bg-opacity-20 border border-red-300 rounded-lg p-3 ".concat(r),children:(0,s.jsx)("p",{className:"text-red-200 text-sm text-center",children:t})})}},2637:function(e,t,r){"use strict";r.d(t,{d:function(){return n}});var s=r(7437);r(2265);var a=r(5137),l=r(4258),i=r(6463);let n=e=>{let{children:t,title:r,subtitle:n,showBackButton:o=!1,onBackClick:c,backButtonText:d="戻る"}=e,u=(0,i.useRouter)();return(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-violet-400 via-violet-600 to-violet-800 flex flex-col items-center justify-start pt-20 pb-6 px-6 relative overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute inset-0 opacity-5 pointer-events-none",children:(0,s.jsx)("div",{className:"absolute inset-0",style:{backgroundImage:"\n            linear-gradient(45deg, rgba(255,255,255,0.1) 25%, transparent 25%),\n            linear-gradient(-45deg, rgba(255,255,255,0.1) 25%, transparent 25%),\n            linear-gradient(45deg, transparent 75%, rgba(255,255,255,0.1) 75%),\n            linear-gradient(-45deg, transparent 75%, rgba(255,255,255,0.1) 75%)\n          ",backgroundSize:"40px 40px",backgroundPosition:"0 0, 0 20px, 20px -20px, -20px 0px"}})}),(0,s.jsxs)("div",{className:"absolute inset-0 opacity-5 pointer-events-none",children:[(0,s.jsx)("div",{className:"absolute top-20 left-10 w-32 h-32 bg-white rounded-full blur-3xl"}),(0,s.jsx)("div",{className:"absolute bottom-40 right-10 w-40 h-40 bg-white rounded-full blur-3xl"}),(0,s.jsx)("div",{className:"absolute top-1/2 left-1/4 w-24 h-24 bg-white rounded-full blur-2xl"})]}),(0,s.jsxs)("div",{className:"w-full max-w-md lg:max-w-lg xl:max-w-xl bg-white/10 backdrop-blur-sm rounded-2xl p-6 lg:p-8 relative z-10",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[o&&(0,s.jsxs)("button",{onClick:()=>{c?c():u.back()},className:"flex items-center space-x-2 text-white hover:text-white/80 transition-colors",children:[(0,s.jsx)(a.Z,{size:20}),(0,s.jsx)("span",{className:"text-sm font-medium",children:d})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(l.Z,{className:"text-white",size:24}),(0,s.jsx)("h1",{className:"text-white text-xl lg:text-2xl font-semibold",children:"設定"})]}),!o&&(0,s.jsx)("div",{className:"w-16"})," "]}),(0,s.jsxs)("div",{className:"text-center mb-6",children:[(0,s.jsx)("h2",{className:"text-white text-2xl lg:text-3xl font-light mb-2",style:{fontFamily:"Brush Script MT, cursive"},children:r}),n&&(0,s.jsx)("p",{className:"text-white/80 text-sm lg:text-base",children:n})]}),(0,s.jsx)("div",{className:"space-y-6",children:t})]})]})}},1887:function(e,t,r){"use strict";r.d(t,{D$:function(){return a},ZL:function(){return l},le:function(){return s}});let s=e=>{try{return localStorage.getItem(e)}catch(t){return console.error("Error accessing localStorage for key ".concat(e,":"),t),null}},a=(e,t)=>{try{localStorage.setItem(e,t)}catch(t){console.error("Error setting localStorage for key ".concat(e,":"),t)}},l=()=>{try{localStorage.clear()}catch(e){console.error("Error clearing localStorage:",e)}}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=8e3)}),_N_E=e.O()}]);