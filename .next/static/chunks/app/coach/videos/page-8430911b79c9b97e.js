(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[921],{1402:function(e,t,s){Promise.resolve().then(s.bind(s,5755))},5755:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var l=s(7437),a=s(2265),i=s(6463),r=s(488),n=s(4410),c=s(4817),o=s(8954),d=s(8094),u=s(933),x=s(2022);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let h=(0,s(1066).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var m=s(7390);function p(){let e=(0,i.useRouter)(),[t,s]=(0,a.useState)([]),[p,g]=(0,a.useState)(!0),[f,w]=(0,a.useState)(null),[v,b]=(0,a.useState)("all"),[j,y]=(0,a.useState)("");(0,a.useEffect)(()=>{(()=>{let t=localStorage.getItem("access_token"),s=localStorage.getItem("user_type");if(!t){e.push("/auth/login");return}if("coach"!==s){e.push("/user/home");return}})()},[e]),(0,a.useEffect)(()=>{(async()=>{try{g(!0);let l=localStorage.getItem("access_token");if(!l){w("認証トークンがありません"),g(!1);return}let a=await fetch("".concat("https://aps-bbc-02-dhdqd5eqgxa7f0hg.canadacentral-01.azurewebsites.net/api/v1","/videos"),{headers:{Authorization:"Bearer ".concat(l)}});if(!a.ok){let e=await a.text();throw console.error("API呼び出しエラー:",a.status,e),Error("API呼び出しに失敗しました: ".concat(a.status))}let i=await a.json();if(console.log("取得した動画データ:",i),i.length>0){var e,t;console.log("最初の動画のユーザー情報:",{video:i[0],user:i[0].user,username:null===(e=i[0].user)||void 0===e?void 0:e.username,email:null===(t=i[0].user)||void 0===t?void 0:t.email,userKeys:i[0].user?Object.keys(i[0].user):"user object is null/undefined"})}let r=i.map(e=>{var t,s,l;return{video_id:e.video_id,user_id:e.user_id,user_name:(null===(t=e.user)||void 0===t?void 0:t.username)||(null===(s=e.user)||void 0===s?void 0:s.name)||"Unknown User",user_email:(null===(l=e.user)||void 0===l?void 0:l.email)||"unknown@example.com",video_url:e.video_url,thumbnail_url:e.thumbnail_url,club_type:e.club_type,swing_form:e.swing_form,swing_note:e.swing_note,upload_date:e.upload_date,status:e.section_groups&&e.section_groups.length>0?"completed":"pending",priority:e.section_groups&&e.section_groups.length>0?"low":"high"}});s(r),w(null)}catch(e){console.error("動画取得エラー:",e),w(e instanceof Error?e.message:"動画の取得に失敗しました")}finally{g(!1)}})()},[]);let N=t.filter(e=>{let t="all"===v||e.status===v,s=e.user_name.toLowerCase().includes(j.toLowerCase())||e.club_type.toLowerCase().includes(j.toLowerCase())||e.swing_form.toLowerCase().includes(j.toLowerCase())||e.swing_note&&e.swing_note.toLowerCase().includes(j.toLowerCase());return t&&s}),_=t=>{e.push("/coach/videos/".concat(t))},k=e=>{switch(e){case"pending":return"bg-yellow-500";case"in_progress":return"bg-blue-500";case"completed":return"bg-green-500";default:return"bg-gray-500"}},Z=e=>{switch(e){case"pending":return"未対応";case"in_progress":return"対応中";case"completed":return"完了";default:return"不明"}},C=e=>{switch(e){case"high":return"bg-red-500";case"medium":return"bg-yellow-500";case"low":return"bg-green-500";default:return"bg-gray-500"}},z=e=>{switch(e){case"high":return"高";case"medium":return"中";case"low":return"低";default:return"不明"}},S=e=>new Date(e).toLocaleDateString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return(0,l.jsx)(r.d,{title:"動画管理",subtitle:"添削依頼動画の管理",showBackButton:!0,onBackClick:()=>e.push("/coach/home"),backButtonText:"ホーム",children:(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(c.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-white/60",size:20}),(0,l.jsx)("input",{type:"text",placeholder:"ユーザー名、クラブ、問題を検索...",value:j,onChange:e=>y(e.target.value),className:"w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-orange-400"})]}),(0,l.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[{value:"all",label:"全て"},{value:"pending",label:"未対応"},{value:"in_progress",label:"対応中"},{value:"completed",label:"完了"}].map(e=>(0,l.jsx)("button",{onClick:()=>b(e.value),className:"px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-colors ".concat(v===e.value?"bg-orange-500 text-white":"bg-white/10 text-white/80 hover:bg-white/20"),children:e.label},e.value))})]}),(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,l.jsxs)("div",{className:"bg-white/10 rounded-xl p-4 text-center",children:[(0,l.jsx)("div",{className:"text-white text-2xl font-bold",children:t.filter(e=>"pending"===e.status).length}),(0,l.jsx)("div",{className:"text-white/60 text-sm",children:"未対応"})]}),(0,l.jsxs)("div",{className:"bg-white/10 rounded-xl p-4 text-center",children:[(0,l.jsx)("div",{className:"text-white text-2xl font-bold",children:t.filter(e=>"in_progress"===e.status).length}),(0,l.jsx)("div",{className:"text-white/60 text-sm",children:"対応中"})]}),(0,l.jsxs)("div",{className:"bg-white/10 rounded-xl p-4 text-center",children:[(0,l.jsx)("div",{className:"text-white text-2xl font-bold",children:t.filter(e=>"completed"===e.status).length}),(0,l.jsx)("div",{className:"text-white/60 text-sm",children:"完了"})]})]}),p?(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto"}),(0,l.jsx)("p",{className:"text-white/60 mt-4",children:"動画を読み込み中..."})]}):f?(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("p",{className:"text-red-400 mb-4",children:f}),(0,l.jsx)(n.rv,{onClick:()=>window.location.reload(),children:"再試行"})]}):0===N.length?(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)(o.Z,{size:48,className:"mx-auto mb-4 text-white/40"}),(0,l.jsx)("p",{className:"text-white/60",children:"該当する動画がありません"}),(0,l.jsx)("p",{className:"text-white/40 text-sm mt-2",children:"検索条件を変更してください"})]}):(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("h3",{className:"text-white text-lg font-medium",children:["動画一覧 (",N.length,"件)"]}),N.map(t=>(0,l.jsx)("div",{onClick:()=>_(t.video_id),className:"bg-white/10 rounded-xl p-4 cursor-pointer hover:bg-white/20 transition-colors border border-white/20",children:(0,l.jsxs)("div",{className:"flex items-start gap-3",children:[(0,l.jsxs)("div",{className:"relative w-20 h-20 bg-gray-800 rounded-lg overflow-hidden flex-shrink-0",children:[t.thumbnail_url?(0,l.jsx)("img",{src:t.thumbnail_url,alt:"動画サムネイル",className:"w-full h-full object-cover"}):(0,l.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,l.jsx)(o.Z,{size:24,className:"text-white/40"})}),(0,l.jsx)("div",{className:"absolute inset-0 bg-black/20 flex items-center justify-center",children:(0,l.jsx)(d.Z,{size:16,className:"text-white"})})]}),(0,l.jsxs)("div",{className:"flex-1 min-w-0 max-w-[calc(100%-6rem)]",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-2 mb-3",children:[(0,l.jsxs)("h4",{className:"text-white font-medium truncate",children:[t.user_name," さん"]}),(0,l.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,l.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium text-white w-fit ".concat(k(t.status)),children:Z(t.status)}),(0,l.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium text-white w-fit ".concat(C(t.priority)),children:z(t.priority)})]})]}),(0,l.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,l.jsx)("span",{className:"bg-orange-500/20 px-2 py-1 rounded text-xs text-white w-fit",children:t.club_type}),(0,l.jsx)("div",{className:"flex flex-wrap gap-1",children:t.swing_form?t.swing_form.split(",").map((e,t)=>(0,l.jsx)("span",{className:"bg-blue-500/20 px-2 py-1 rounded text-xs text-white w-fit",children:e.trim()},t)):(0,l.jsx)("span",{className:"bg-gray-500/20 px-2 py-1 rounded text-xs text-white w-fit",children:"未設定"})})]}),t.swing_note&&(0,l.jsx)("p",{className:"text-white/70 text-xs line-clamp-2",children:t.swing_note}),(0,l.jsxs)("div",{className:"flex flex-col gap-1 text-white/60 text-xs",children:[(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)(u.Z,{size:14}),(0,l.jsx)("span",{className:"truncate",children:S(t.upload_date)})]}),(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)(x.Z,{size:14}),(0,l.jsx)("span",{className:"truncate",children:t.user_email})]})]})]})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsxs)("button",{onClick:e=>{e.stopPropagation(),_(t.video_id)},className:"bg-orange-500 hover:bg-orange-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2",children:[(0,l.jsx)(h,{size:16}),"詳細"]}),"pending"===t.status&&(0,l.jsxs)("button",{onClick:s=>{s.stopPropagation(),e.push("/coach/videos/".concat(t.video_id,"/feedback"))},className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2",children:[(0,l.jsx)(m.Z,{size:16}),"添削"]})]})]})},t.video_id))]})]})})}},933:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(1066).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},7390:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(1066).Z)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},8094:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(1066).Z)("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]])},4817:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(1066).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},2022:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(1066).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])}},function(e){e.O(0,[571,971,23,744],function(){return e(e.s=1402)}),_N_E=e.O()}]);