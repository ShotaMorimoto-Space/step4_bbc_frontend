(()=>{var e={};e.id=3832,e.ids=[3832],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9968:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>a.a,__next_app__:()=>p,originalPathname:()=>d,pages:()=>u,routeModule:()=>h,tree:()=>c}),r(6698),r(9716),r(5866);var o=r(3191),s=r(8716),l=r(7922),a=r.n(l),n=r(5231),i={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>n[e]);r.d(t,i);let c=["",{children:["user",{children:["request-problem",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,6698)),"/Users/morimotoshouta/Desktop/tech0/STEP4/BBC/bbc-golf-coaching-backend-ver2-main/frontend/app/user/request-problem/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,9716)),"/Users/morimotoshouta/Desktop/tech0/STEP4/BBC/bbc-golf-coaching-backend-ver2-main/frontend/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],u=["/Users/morimotoshouta/Desktop/tech0/STEP4/BBC/bbc-golf-coaching-backend-ver2-main/frontend/app/user/request-problem/page.tsx"],d="/user/request-problem/page",p={require:r,loadChunk:()=>Promise.resolve()},h=new o.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/user/request-problem/page",pathname:"/user/request-problem",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},8684:(e,t,r)=>{Promise.resolve().then(r.bind(r,3355))},3355:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var o=r(326),s=r(7577),l=r(5047),a=r(9193),n=r(7869);let i=["スライス","フック","トップ","ダフリ","飛距離不足","方向性","弾道の高さ","スピン量","リズム","ミート率"];function c(){let e=(0,l.useRouter)(),[t,r]=(0,s.useState)([]),[c,u]=(0,s.useState)(""),[d,p]=(0,s.useState)({}),h=e=>{t.includes(e)?r(t.filter(t=>t!==e)):t.length<2&&r([...t,e])},m=async()=>{console.log("次へ進む - 選択された問題:",t),console.log("次へ進む - 入力されたメモ:",c);let r=JSON.parse(localStorage.getItem("sb:req:draft")||"{}"),o={...r,problems:t,note:c};console.log("保存前のドラフト:",r),console.log("更新後のドラフト:",o),localStorage.setItem("sb:req:draft",JSON.stringify(o)),console.log("localStorageに保存されたドラフト:",localStorage.getItem("sb:req:draft"));let s=localStorage.getItem("sb:req:files");if(s)try{let r=JSON.parse(s);if(r.length>0&&r[0]&&r[0].url){if(console.log("保存されたファイル:",r),!r[0].name||!r[0].url){console.error("ファイル情報が不完全:",r[0]),alert("ファイル情報が不完全です。確認画面で再度アップロードしてください。"),e.push("/user/request-confirm");return}try{let s;let l=new FormData;try{if(!r[0].url||"undefined"===r[0].url||"null"===r[0].url)throw Error("動画ファイルのURLが無効です");if(!(s=r[0].url.startsWith("blob:")?r[0].blob||await fetch(r[0].url).then(e=>e.blob()):await fetch(r[0].url).then(e=>e.blob())))throw Error("動画ファイルの取得に失敗しました");l.append("video_file",s,r[0].name),console.log("動画ファイルを追加:",r[0].name)}catch(t){console.error("動画ファイルの取得エラー:",t),alert("動画ファイルの処理に失敗しました。確認画面で再度アップロードしてください。"),e.push("/user/request-confirm");return}let a=localStorage.getItem("user_id"),n=localStorage.getItem("user_email");if(a&&l.append("user_id",a),n&&l.append("user_email",n),o.club&&(l.append("club_type",o.club),console.log("クラブタイプを追加:",o.club)),t.length>0){let e=t.join(", ");l.append("swing_form",e),console.log("スイング形式（問題）を追加:",e)}if(c&&(l.append("swing_note",c),console.log("スイングメモを追加:",c)),o.videoThumb&&o.videoThumb.startsWith("data:image/"))try{let e=await fetch(o.videoThumb),t=await e.blob();l.append("thumbnail_file",t,"thumbnail.jpg"),console.log("サムネイルファイルを追加")}catch(e){console.error("サムネイル処理エラー:",e),console.log("サムネイルなしでアップロードを続行します")}for(let[e,t]of(console.log("FormDataの内容確認:"),l.entries()))console.log(`${e}:`,t);let i="https://aps-bbc-02-dhdqd5eqgxa7f0hg.canadacentral-01.azurewebsites.net/api/v1",u=`${i}/upload-video`;for(let[e,t]of(console.log("アップロードURL:",u),console.log("APIベースURL:",i),console.log("完全なURL:",u),console.log("FormDataの内容（送信前）:"),l.entries()))console.log(`${e}:`,t);let d=await fetch(u,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:l}).catch(e=>{throw console.error("fetch実行エラー:",e),Error(`ネットワークエラー: ${e.message}`)});if(d.ok){let t=await d.json();console.log("動画アップロード成功:",t),e.push("/user/request-confirm")}else{console.error("動画アップロード失敗:",d.status,d.statusText);try{let e=await d.text();console.error("エラー詳細:",e),alert(`動画アップロードに失敗しました: ${d.status} ${d.statusText}

詳細: ${e}`)}catch(e){alert(`動画アップロードに失敗しました: ${d.status} ${d.statusText}`)}}}catch(t){console.error("動画アップロードエラー:",t);let e=t instanceof Error?t.message:String(t);alert(`動画アップロード中にエラーが発生しました:

${e}`)}}else e.push("/user/request-confirm")}catch(t){console.error("ファイル解析エラー:",t),e.push("/user/request-confirm")}else e.push("/user/request-confirm")};return(0,o.jsxs)(a.T,{title:"問題選択",subtitle:"スイングの問題を選択してください（最大2つまで）",showBackButton:!0,onBackClick:()=>{e.push("/user/request-club")},currentStep:2,totalSteps:4,children:[d.club&&(0,o.jsxs)("div",{className:"bg-blue-500/20 border border-blue-500/30 rounded-lg p-4 text-blue-300 text-sm mb-6",children:[o.jsx("div",{className:"font-bold mb-2",children:"選択されたクラブ:"}),o.jsx("div",{children:d.club})]}),o.jsx("div",{className:"mb-8",children:o.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(e=>{let r=t.includes(e);return o.jsx("button",{onClick:()=>h(e),disabled:!r&&t.length>=2,className:`px-4 py-2 rounded-full text-sm transition-all duration-200 ${r?"bg-white text-violet-600 border border-white shadow-lg":t.length>=2&&!r?"bg-white/10 text-white/50 border border-white/10 cursor-not-allowed":"bg-white/20 text-white border border-white/30 hover:bg-white/30 hover:scale-105"}`,children:e},e)})})}),(0,o.jsxs)("div",{className:"mb-8",children:[o.jsx("h2",{className:"text-white mb-2 text-lg font-medium",children:"自由記入（任意）"}),o.jsx("textarea",{value:c,onChange:e=>u(e.target.value),placeholder:"その他あれば記入してください",className:"w-full min-h-[120px] bg-white/20 rounded-2xl text-white p-4 placeholder-white/60 border border-white/30 focus:outline-none focus:border-white/50 transition-colors resize-none"})]}),o.jsx("div",{className:"mt-8",children:o.jsx(n.Jr,{onClick:m,className:"w-full",children:"次へ"})})]})}},6698:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>a,__esModule:()=>l,default:()=>n});var o=r(8570);let s=(0,o.createProxy)(String.raw`/Users/morimotoshouta/Desktop/tech0/STEP4/BBC/bbc-golf-coaching-backend-ver2-main/frontend/app/user/request-problem/page.tsx`),{__esModule:l,$$typeof:a}=s;s.default;let n=(0,o.createProxy)(String.raw`/Users/morimotoshouta/Desktop/tech0/STEP4/BBC/bbc-golf-coaching-backend-ver2-main/frontend/app/user/request-problem/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[8948,4471,4917],()=>r(9968));module.exports=o})();