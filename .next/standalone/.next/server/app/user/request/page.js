(()=>{var e={};e.id=6519,e.ids=[6519],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8050:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>h,tree:()=>c}),s(1392),s(9716),s(5866);var r=s(3191),o=s(8716),l=s(7922),i=s.n(l),a=s(5231),n={};for(let e in a)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>a[e]);s.d(t,n);let c=["",{children:["user",{children:["request",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,1392)),"/Users/morimotoshouta/Desktop/tech0/STEP4/BBC/bbc-golf-coaching-backend-ver2-main/frontend/app/user/request/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,9716)),"/Users/morimotoshouta/Desktop/tech0/STEP4/BBC/bbc-golf-coaching-backend-ver2-main/frontend/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/morimotoshouta/Desktop/tech0/STEP4/BBC/bbc-golf-coaching-backend-ver2-main/frontend/app/user/request/page.tsx"],u="/user/request/page",m={require:s,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:o.x.APP_PAGE,page:"/user/request/page",pathname:"/user/request",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},1059:(e,t,s)=>{Promise.resolve().then(s.bind(s,9611))},9611:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var r=s(326),o=s(7577);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(6557).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var i=s(3685),a=s(4019),n=s(5047),c=s(9193),d=s(7869);function u(){let e=(0,n.useRouter)(),[t,s]=(0,o.useState)([]),[u,m]=(0,o.useState)(!1),[h]=(0,o.useState)(0),[g,p]=(0,o.useState)(""),[x,b]=(0,o.useState)(""),[v,f]=(0,o.useState)(!1),j=(0,o.useRef)(null),y=e=>new Promise((t,s)=>{if(e.size>31457280){s(Error("ファイルサイズが大きすぎます（30MB以下にしてください）"));return}let r=document.createElement("video"),o=document.createElement("canvas"),l=o.getContext("2d");if(!l){s(Error("Canvas 2D context が利用できません"));return}let i=setTimeout(()=>{s(Error("クライアントサイド生成がタイムアウトしました"))},1e4);r.onloadedmetadata=()=>{if(console.log("動画メタデータ読み込み完了:",{videoWidth:r.videoWidth,videoHeight:r.videoHeight,duration:r.duration}),r.videoWidth>0&&r.videoHeight>0){let e,t;let s=r.videoWidth,l=r.videoHeight;if(console.log("動画寸法:",{videoWidth:s,videoHeight:l}),s>400||l>300){let r=Math.min(400/s,300/l);e=Math.floor(s*r),t=Math.floor(l*r)}else e=s,t=l;console.log("計算されたCanvasサイズ:",{width:e,height:t}),o.width=e,o.height=t,console.log("Canvasサイズ設定完了:",{canvasWidth:o.width,canvasHeight:o.height,videoWidth:r.videoWidth,videoHeight:r.videoHeight});let i=Math.min(1,r.duration/2);r.currentTime=i}else console.error("動画の寸法が取得できません"),s(Error("動画の寸法が取得できません"))},r.onseeked=()=>{try{console.log("フレーム抽出開始:",{currentTime:r.currentTime,videoWidth:r.videoWidth,videoHeight:r.videoHeight,canvasWidth:o.width,canvasHeight:o.height}),l.fillStyle="#000000",l.fillRect(0,0,o.width,o.height),l.drawImage(r,0,0,o.width,o.height);let e=o.toDataURL("image/jpeg",.8);console.log("サムネイル生成完了:",{thumbnailUrl:e.substring(0,50)+"...",canvasWidth:o.width,canvasHeight:o.height,thumbnailLength:e.length}),clearTimeout(i),t(e)}catch(e){console.error("サムネイル生成エラー:",e),clearTimeout(i),s(e)}},r.onerror=e=>{console.error("動画読み込みエラー:",e),clearTimeout(i),s(Error("動画の読み込みに失敗しました"))},r.src=URL.createObjectURL(e),r.load(),r.oncanplay=()=>{console.log("動画再生可能:",{videoWidth:r.videoWidth,videoHeight:r.videoHeight,readyState:r.readyState})}}),_=()=>{let t=localStorage.getItem("access_token"),s=localStorage.getItem("user_email");return!!t&&!!s||(p("ログインが必要です。ログインページに移動します。"),setTimeout(()=>{e.push("/auth/login")},2e3),!1)},w=async e=>{if(!_())throw Error("認証が必要です");let t=null;try{b("クライアントサイドでサムネイル生成中..."),console.log("クライアントサイドサムネイル生成開始..."),t=await y(e),console.log("クライアントサイド生成成功:",{thumbnailLength:t.length,thumbnailStart:t.substring(0,50),isDataUrl:t.startsWith("data:image/")}),b("クライアントサイドでサムネイル生成完了！"),setTimeout(()=>b(""),3e3)}catch(e){console.log("クライアントサイド生成失敗:",e),b("サムネイル生成に失敗しました"),setTimeout(()=>b(""),3e3)}let s=new FormData;s.append("video_file",e);let r=localStorage.getItem("user_email"),o=localStorage.getItem("user_id");r&&s.append("user_email",r),o&&s.append("user_id",o);let l=localStorage.getItem("sb:req:draft");if(l)try{let e=JSON.parse(l);if(console.log("保存されたドラフトデータ:",e),e.club&&(s.append("club_type",e.club),console.log("クラブタイプを追加:",e.club)),e.problems&&e.problems.length>0){let t=e.problems.join(", ");s.append("swing_form",t),console.log("スイング形式（問題）を追加:",t)}e.note&&(s.append("swing_note",e.note),console.log("スイングメモを追加:",e.note))}catch(e){console.error("ドラフトデータの解析に失敗:",e)}for(let[e,t]of(console.log("FormDataの内容確認:"),s.entries()))console.log(`${e}:`,t);let i="https://aps-bbc-02-dhdqd5eqgxa7f0hg.canadacentral-01.azurewebsites.net/api/v1",a=`${i}/upload-video`;console.log("アップロード情報:",{apiUrl:i,uploadUrl:a,userEmail:r,userId:o,fileName:e.name,fileSize:e.size,clientThumbnailGenerated:!!t});try{let e=await fetch(a,{method:"POST",body:s});if(console.log("アップロードレスポンス:",{status:e.status,statusText:e.statusText,headers:Object.fromEntries(e.headers.entries())}),!e.ok){let t;try{t=await e.json()}catch{t={detail:e.statusText}}throw Error(`アップロード失敗: ${t.detail||e.statusText}`)}let r=await e.json();console.log("アップロード成功:",r),console.log("アップロード結果の詳細:",{user_id:r.user_id,video_url:r.video_url,thumbnail_url:r.thumbnail_url,club_type:r.club_type,swing_form:r.swing_form}),r.user_id&&(localStorage.setItem("user_id",r.user_id),console.log("新しいuser_idをlocalStorageに保存:",r.user_id));let o=t||r.thumbnail_url;return console.log("サムネイルURL決定:",{clientThumbnail:t?t.substring(0,50)+"...":"なし",serverThumbnail:r.thumbnail_url||"なし",finalThumbnail:o?o.substring(0,50)+"...":"なし",thumbnailLength:o?.length}),{video_url:r.video_url,thumbnail_url:o}}catch(e){throw console.error("動画アップロードエラー:",e),e}},S=async e=>{if(e.length){m(!0),p("動画をアップロード中...");try{let t=[],r=[];if(e.forEach(e=>{if(e.size>31457280){r.push(e.name);return}}),r.length>0){p(`以下のファイルは30MBを超えているため選択できません: ${r.join(", ")}`),setTimeout(()=>p(""),5e3),m(!1);return}for(let s of e)try{let e=await w(s),r=crypto.randomUUID(),o=URL.createObjectURL(s);t.push({id:r,file:s,url:o,size:s.size,name:s.name});let l={...JSON.parse(localStorage.getItem("sb:req:draft")||"{}"),videoThumb:e.thumbnail_url,videoUrl:e.video_url};console.log("ドラフト保存:",{videoThumb:e.thumbnail_url?.substring(0,50)+"...",videoUrl:e.video_url,thumbnailLength:e.thumbnail_url?.length}),localStorage.setItem("sb:req:draft",JSON.stringify(l))}catch(e){console.error(`ファイル ${s.name} のアップロード失敗:`,e),p(`ファイル ${s.name} のアップロードに失敗しました`),setTimeout(()=>p(""),5e3),m(!1);return}s(e=>{let s=[...e,...t],r=s.map(e=>({id:e.id,name:e.name,size:e.size,url:e.url}));return localStorage.setItem("sb:req:files",JSON.stringify(r)),s}),p(""),m(!1),console.log("[upload] 動画アップロード完了。次へボタンを押して次の画面に進んでください。")}catch(e){console.error("動画処理エラー:",e),p("動画の処理に失敗しました"),setTimeout(()=>p(""),5e3),m(!1)}}},k=async()=>{let e=window;if(e.showOpenFilePicker)try{console.log("[picker] Using File System Access API");let t=await e.showOpenFilePicker({multiple:!0,types:[{description:"Videos",accept:{"video/*":[".mp4",".mov",".webm",".m4v"]}}],excludeAcceptAllOption:!0}),s=await Promise.all(t.map(e=>e.getFile()));console.log("[picked]",s.length),S(s);return}catch(e){console.log("File picker cancelled or failed:",e)}console.log("[picker] Using fallback input"),j.current?.click()},N=e=>{s(t=>{let s=t.find(t=>t.id===e);return s&&URL.revokeObjectURL(s.url),t.filter(t=>t.id!==e)})},T=e=>`${(e/1048576).toFixed(1)}MB`;return(0,r.jsxs)(c.T,{title:"動画アップロード",subtitle:"添削依頼する動画を選択してください",currentStep:h,totalSteps:4,children:[t.length>0&&!u&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"bg-blue-500/20 border border-blue-500/30 rounded-lg p-4 text-blue-300 text-sm",children:[r.jsx("div",{className:"font-bold mb-2",children:"次の画面に渡される情報:"}),(0,r.jsxs)("div",{children:["動画ファイル数: ",t.length,"個"]}),(0,r.jsxs)("div",{children:["ファイル名: ",t.map(e=>e.name).join(", ")]}),(0,r.jsxs)("div",{children:["合計サイズ: ",T(t.reduce((e,t)=>e+t.size,0))]})]}),r.jsx("div",{className:"text-center",children:r.jsx(d.Jr,{onClick:()=>{let s=t.map(e=>({id:e.id,name:e.name,size:e.size,url:e.url}));localStorage.setItem("selectedVideos",JSON.stringify(s)),console.log("動画ファイル情報を保存:",s),e.push("/user/request-club")},className:"w-full",children:"次へ"})})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center mb-8",children:[r.jsx("button",{type:"button",onClick:k,disabled:u,"aria-label":"動画をアップロード",className:`bg-white rounded-full h-[54px] px-6 flex items-center gap-3 shadow-lg hover:shadow-xl transition-all duration-200 active:scale-95 ${u?"opacity-50 cursor-not-allowed":""}`,children:u?(0,r.jsxs)(r.Fragment,{children:[r.jsx(l,{className:"text-violet-600 animate-spin",size:20}),r.jsx("span",{className:"text-violet-600 font-medium",children:"アップロード中..."})]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx(i.Z,{className:"text-violet-600",size:20}),r.jsx("span",{className:"text-violet-600 font-medium",children:"動画をアップロード"})]})}),g&&r.jsx(d.Ou,{message:g}),x&&r.jsx("div",{className:"bg-blue-500/20 border border-blue-500/30 rounded-lg p-3 text-blue-300 text-sm",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(l,{className:"animate-spin",size:16}),r.jsx("span",{children:x})]})}),t.length>0&&!u&&(0,r.jsxs)("div",{className:"bg-green-500/20 border border-green-500/30 rounded-lg p-4 text-green-300 text-sm",children:[r.jsx("div",{className:"font-bold mb-2",children:"✅ 動画アップロード完了！"}),(0,r.jsxs)("div",{children:[t.length,"個の動画が正常にアップロードされました"]}),r.jsx("div",{className:"mt-2 text-xs opacity-80",children:"下の「次へ」ボタンを押して、クラブ選択画面に進んでください"})]})]}),r.jsx("input",{ref:j,type:"file",accept:"video/*,.mp4,.mov,.webm",multiple:!0,onChange:e=>{let t=Array.from(e.target.files??[]);console.log("[picked]",t.length),S(t),e.currentTarget.value=""},className:"hidden"}),t.length>0&&(0,r.jsxs)("div",{className:"space-y-3 mb-8",children:[r.jsx("h3",{className:"text-white text-lg font-medium mb-4",children:"選択された動画"}),t.map(e=>(0,r.jsxs)("div",{className:"rounded-2xl bg-white/10 border border-white/15 p-3 flex items-center gap-3",children:[r.jsx("video",{src:e.url,muted:!0,playsInline:!0,className:"w-16 h-10 object-cover rounded-lg bg-black/20"}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-white text-sm font-medium truncate",children:e.name}),r.jsx("p",{className:"text-white/70 text-xs",children:T(e.size)})]}),r.jsx("button",{onClick:()=>N(e.id),"aria-label":`${e.name}を削除`,className:"w-8 h-8 rounded-full bg-red-500/20 hover:bg-red-500/30 flex items-center justify-center transition-colors",children:r.jsx(a.Z,{className:"text-red-400",size:16})})]},e.id))]})]})]})}},3685:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(6557).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},4019:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(6557).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},1392:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>i,__esModule:()=>l,default:()=>a});var r=s(8570);let o=(0,r.createProxy)(String.raw`/Users/morimotoshouta/Desktop/tech0/STEP4/BBC/bbc-golf-coaching-backend-ver2-main/frontend/app/user/request/page.tsx`),{__esModule:l,$$typeof:i}=o;o.default;let a=(0,r.createProxy)(String.raw`/Users/morimotoshouta/Desktop/tech0/STEP4/BBC/bbc-golf-coaching-backend-ver2-main/frontend/app/user/request/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[8948,4471,4917],()=>s(8050));module.exports=r})();